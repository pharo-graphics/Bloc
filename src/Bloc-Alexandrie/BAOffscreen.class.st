"
I provide text measurement in an off-screen canvas.

For time efficiency, I implement the singleton pattern, to reuse an instance along a Pharo session.
"
Class {
	#name : 'BAOffscreen',
	#superclass : 'Object',
	#instVars : [
		'aeCanvas',
		'textMeasurer'
	],
	#classInstVars : [
		'instance'
	],
	#package : 'Bloc',
	#tag : 'Alexandrie-Utility',
	#package : 'Bloc-Alexandrie',
	#tag : 'Utility'
}

{ #category : 'accessing' }
BAOffscreen class >> instance [

	^ instance ifNil: [ instance := self new ]
]

{ #category : 'accessing' }
BAOffscreen class >> resetInstance [
	<script>

	instance := nil
]

{ #category : 'api' }
BAOffscreen >> canvas [

	self ensureReady.
	^ aeCanvas
]

{ #category : 'api' }
BAOffscreen >> ensureReady [

	(aeCanvas notNil and: [ aeCanvas isValid ]) ifTrue: [ ^ self ].

	aeCanvas := AeCanvas extent: 1 asPoint.

	textMeasurer := BACanvasTextMeasurer new
							canvas: aeCanvas;
							yourself
]

{ #category : 'api' }
BAOffscreen >> measureTextParagraph: aBlTextParagraph [

	self textMeasurer measureTextParagraph: aBlTextParagraph
]

{ #category : 'api' }
BAOffscreen >> textMeasurer [

	self ensureReady.
	^ textMeasurer
]
